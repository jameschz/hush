tinymce.PluginManager.add('wxai', function(editor, url) {
	
	// body
	var plug_name = 'Weixin Artical Importer';
	var plug_tips = '微信文章导入';
	var win_body = [
	{type:'notification', text:'填写微信文章地址并确认之后，工具将会把微信文章内容导入编辑器。遇到图片无法显示的问题不用担心，保存之后图片就自然显示了。系统会自动简化微信的代码，如果排版不好看辛苦您调整下哈 :)', style:'width:458px;top:10px;'},
	{type:'spacer', style:'height:5px;'},
	{type:'textbox', name:'link', label:'微信文章地址'}
	];
	
	// Add a button that opens a window
	editor.addButton('wxai', {
		text : '',
		icon : false,
		image : '/app/tinymce/skins/lightgray/img/wxai.png',
		tooltip : plug_tips,
		onclick : function() {
			// Open window
			editor.windowManager.open({
				title : plug_name,
				body : win_body,
				width : 500,
				height : 180,
				onsubmit : function(e) {
					// Insert content when the window form is submitted
					$.post('/tinymce/wxai', {
						'link' : e.data.link
					}, function(r) {
						if (r.err == '0') {
							var str = r.msg;
							editor.setContent(str);
						} else {
							alert(r.msg);
						}
					}, 'json');
				}
			});
		}
	});

	// Adds a menu item to the tools menu
	editor.addMenuItem('wxai', {
		text : plug_name,
		context : 'tools',
		tooltip : plug_tips,
		onclick : function() {
			// Open window
			editor.windowManager.open({
				title : plug_name,
				body : win_body,
				width : 500,
				height : 180,
				onsubmit : function(e) {
					// Insert content when the window form is submitted
					$.post('/tinymce/wxai', {
						'link' : e.data.link
					}, function(r) {
						if (r.err == '0') {
							var str = r.msg;
							editor.setContent(str);
						} else {
							alert(r.msg);
						}
					}, 'json');
				}
			});
		}
	});

	return {
		getMetadata : function() {
			return {
				title : plug_name
			};
		}
	};
});