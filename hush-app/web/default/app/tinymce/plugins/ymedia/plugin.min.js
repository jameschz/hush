tinymce.PluginManager.add('ymedia', function(editor, url) {
	
	// body
	var plug_name = 'Media Manager';
	var plug_tips = '视频管理工具';
	var win_body = [
	{type:'notification', text:'目前只支持优酷的视频通用代码以及秒拍的视频', style:'width:458px;top:10px;'},
	{type:'spacer', style:'height:5px;'},
	{type:'textbox', name:'code', label:'视频通用代码'},
//	{type:'textbox', name:'link_wb', label:'微博网页地址'},
	{type:'textbox', name:'link_mp', label:'秒拍网页地址'}
	];
	
	// Add a button that opens a window
	editor.addButton('ymedia', {
		text : '',
		icon : 'media',
		tooltip : plug_tips,
		onclick : function() {
			// Open window
			editor.windowManager.open({
				title : plug_name,
				body : win_body,
				width : 500,
				height : 180,
				onsubmit : function(e) {
					// Insert content when the window form is submitted
					$.post('/hush/ymedia', {
						'code' : e.data.code,
//						'link_wb' : e.data.link_wb,
						'link_mp' : e.data.link_mp
					}, function(r) {
						if (r.err == '0') {
							var html = r.msg;
							editor.insertContent(html);
						} else {
							alert(r.msg);
						}
					}, 'json');
				}
			});
		}
	});

	// Adds a menu item to the tools menu
	editor.addMenuItem('ymedia', {
		text : plug_name,
		context : 'tools',
		tooltip : plug_tips,
		onclick : function() {
			// Open window
			editor.windowManager.open({
				title : plug_name,
				body : win_body,
				width : 500,
				height : 180,
				onsubmit : function(e) {
					// Insert content when the window form is submitted
					$.post('/hush/ymedia', {
						'code' : e.data.code,
//						'link_wb' : e.data.link_wb,
						'link_mp' : e.data.link_mp
					}, function(data) {
						if (r.err == '0') {
							var html = r.msg;
							editor.insertContent(html);
						} else {
							alert(r.msg);
						}
					}, 'json');
				}
			});
		}
	});

	return {
		getMetadata : function() {
			return {
				title : plug_name
			};
		}
	};
});